<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Crossover</title>

    <meta property="og:title" content="Crossover" />
    <meta property="description" content="Where else have you seen that actor?" />
    <meta property="og:description" content="Where else have you seen that actor?" />
    <meta property="og:url" content="https://crossover.rknight.me" />
    <meta property="og:image" content="https://crossover.rknight.me/assets/preview.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="/assets/icons/site.webmanifest">
    <link rel="mask-icon" href="/assets/icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#090909">
    <meta name="theme-color" content="#090909">

    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=atkinson-hyperlegible:400,400i,700,700i" rel="stylesheet" />

    <link rel="stylesheet" href="/assets/simple.min.css">
    <link rel="stylesheet" href="/assets/styles.css">

    <script src="/assets/shows.js"></script>

    <script src="https://cdn.usefathom.com/script.js" data-site="RBRMVQSU" defer></script>

</head>

<body>
    <header>
        <img src="/assets/logo_small.png" alt="Logo that says Crossover">
        <h1 style="display: none;">Crossover</h1>
        <h2 class="subtitle">Where else have you seen that actor?</h2>
        <p>Data from <a href="https://www.themoviedb.org">TMDB</a>. Made by <a href="https://rknight.me">Robb Knight</a>.</p>
        <p>If you like this <em>and</em> medical shows, check out <a href="https://doubleshift.rknight.me/">DoubleShift</a>.</p>
    </header>
    
    <main>
        <div class="searcher">
            <div>
                <form id="search-one-form">
                    <input type="text" id="search-one-input" placeholder="Show One" required><br>
                    <input type="submit" value="Search" id="search-one">
                </form>
                <select id="select-one"><option value="">choose a show</option></select>
            </div>
            <div>
                <form id="search-two-form">
                    <input type="text" id="search-two-input" placeholder="Show Two" required><br>
                    <input type="submit" value="Search" id="search-two">
                </form>
                <select id="select-two"><option value="">choose a show</option></select>
            </div>
        </div>

        <div class="output">
            <div class="output-row">
                <div>
                    <div id="show-one-name" class="show-name"><em>no show selected</em></div>
                </div>
                <div></div>
                <div>
                    <div id="show-two-name" class="show-name"><em>no show selected</em></div>
                </div>
            </div>
        </div>

        <div id="output" class="output"></div>
    </main>
    
    <footer>
        <p>Crossover by <a href="https://rknight.me">Robb Knight</a>. Using <a href="https://simplecss.org">simple.css</a> • Like this? <a href="https://rknight.me/coffee">Buy me a coffee</a></p>
    </footer>

    <dialog>
        <p style="margin: 0;"><strong>Choose a show:</strong></p>
        <div>
            <ul id="search-results">
                
            </ul>
        </div>
        <form method="dialog">
            <button>Close</button>
        </form>
    </dialog>

    <a href="https://github.com/rknightuk/crossover" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#174533; color:#090909; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <script>
        (function () {
            let showOne = shows[1396]
            let showTwo = shows[2004]

            let currentSearch = 1
            const dialog = document.querySelector("dialog")
            const searchResults = document.getElementById('search-results')
            const searchOneForm = document.getElementById('search-one-form')
            const searchTwoForm = document.getElementById('search-two-form')
            const searchOneInput = document.getElementById('search-one-input')
            const searchTwoInput = document.getElementById('search-two-input')
            const selectOne = document.getElementById('select-one')
            const selectTwo = document.getElementById('select-two')

            fetchShowInfo = (showId) => {
                searchResults.innerHTML = 'Loading...'
                fetch(
                    `/.netlify/functions/aggregate?showId=${showId}`,
                    {
                        method: 'get',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    },
                )
                .then(response => {
                    if (!response.ok)
                    {
                        return 'error'
                    }
                    return response.json()
                })
                .then(data => {
                    shows = {
                        ...shows,
                        ...data,
                    }

                    if (currentSearch === 1)
                    {
                        showOne = shows[showId]
                    }
                    else
                    {
                        showTwo = shows[showId]
                    }

                    dialog.close()

                    renderActors()
                    appendSelect(shows[showId].showData.id, shows[showId].showData.name)
                })
            }

            appendSelect = (id, name) => {
                selectOne.insertAdjacentHTML('beforeend', `<option value="${id}">${name}</option>`)
                selectTwo.insertAdjacentHTML('beforeend', `<option value="${id}">${name}</option>`)
            }

            renderSelects = (values) => {
                Object.keys(shows).forEach((key) => {
                    selectOne.insertAdjacentHTML('beforeend', `<option value="${key}">${shows[key].showData.name}</option>`)
                    selectTwo.insertAdjacentHTML('beforeend', `<option value="${key}">${shows[key].showData.name}</option>`)
                })
            }

            renderActors = () => {
                selectOne.selectedIndex = 0
                selectTwo.selectedIndex = 0
                document.getElementById('show-one-name').innerHTML = `<strong>${showOne.showData.name}</strong><br>${showOne.showData.number_of_seasons} seasons • ${showOne.showData.number_of_episodes} episodes`
                document.getElementById('show-two-name').innerHTML = `<strong>${showTwo.showData.name}</strong><br>${showTwo.showData.number_of_seasons} seasons • ${showTwo.showData.number_of_episodes} episodes`
                const intersection = Object.keys(showOne.actors).filter(element => Object.keys(showTwo.actors).includes(element))

                const x = intersection.map(id => {
                    return {
                        actor: showOne.actors[id],
                        showOne: showOne.actors[id].role,
                        showTwo: showTwo.actors[id].role,
                    }
                }).sort((a, b) => {
                    const countA = a.showOne.episode_count + a.showTwo.episode_count
                    const countB = b.showOne.episode_count + b.showTwo.episode_count
                    return (countA > countB) ? -1 : ((countB > countA) ? 1 : 0)
                })

                const output = document.getElementById('output')

                output.innerHTML = `<div style="text-align: center;border-bottom: 1px solid var(--border);">
                    <p><strong>${intersection.length} actors have appeared in both shows</strong></p>
                </div>`

                x.forEach((a, i) => {
                    output.insertAdjacentHTML('beforeend', `
                <div class="output-row">
                    <div>
                        <strong>${a.showOne.character}</strong>${a.showOne.episode_count} episode${a.showOne.episode_count > 1 ? 's' : ''}
                    </div>
                    <div class="actor-div">
                        <strong>${i + 1}</strong>
                            <a href="https://www.themoviedb.org/person/${a.actor.id}" target="_blank" rel="noopener">
                                <div class="actor-image" style="background-image: url('${a.actor.photo}')"></div>
                                ${a.actor.name}
                            </a>
                    </div>
                    <div>
                        <strong>${a.showTwo.character}</strong>${a.showTwo.episode_count} episode${a.showTwo.episode_count > 1 ? 's' : ''}
                    </div>
                </div>
                `)
                })
            }

            const search = (value) => {
                searchResults.innerHTML = 'Loading...'
                dialog.showModal()
                fetch(
                    `/.netlify/functions/search?search=${value}`,
                    {
                        method: 'get',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    },
                )
                .then(response => {
                    if (!response.ok)
                    {
                        return 'error'
                    }
                    return response.json()
                })
                .then(data => {
                    if (!data || data.length === 0)
                    {
                        searchResults.innerHTML = '<li>No shows found :(</li>' 
                        return
                    }
                    searchResults.innerHTML = ''
                    data.map(show => {
                        searchResults.insertAdjacentHTML('beforeend', `<li><a onclick="fetchShowInfo(${show.id})" href="#" data-id="${show.id}" data-name="${show.title}">${show.title} (${show.year})</a></li>`)
                    })
                })
            }

            const searchOne = document.getElementById('search-one')
            const searchTwo = document.getElementById('search-two')

            searchOneForm.addEventListener('submit', (e) => {
                e.preventDefault()
                currentSearch = 1
                search(searchOneInput.value)
                return false
            })
            searchTwoForm.addEventListener('submit', (e) => {
                e.preventDefault()
                currentSearch = 2
                search(searchTwoInput.value)
                return false
            })

            selectOne.addEventListener('change', (e) => {
                showOne = shows[e.currentTarget.value]
                renderActors()
            })

            selectTwo.addEventListener('change', (e) => {
                showTwo = shows[e.currentTarget.value]
                renderActors()
            })

            renderActors()
            renderSelects()
        })()
    </script>
</body>

</html>